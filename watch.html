<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مشاهدة الفيديو</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
body{margin:0;background:#111;color:white;font-family:Arial;padding:20px;}
.video-wrapper{max-width:800px;margin:auto;}
video, iframe{width:100%;border-radius:10px;}
h2{margin-top:10px;}
</style>
</head>
<body>

<div class="video-wrapper">
  <div id="playerContainer"></div>
  <h2 id="videoTitle"></h2>
  <p>عدد المشاهدات: <span id="videoViews">0</span></p>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAYcZ2_RjaI4fjP14QlqbUbL3rWvPPWnas",
  authDomain: "sheko-store.firebaseapp.com",
  databaseURL: "https://sheko-store-default-rtdb.firebaseio.com",
  projectId: "sheko-store",
  storageBucket: "sheko-store.appspot.com",
  messagingSenderId: "113892775847",
  appId: "1:113892775847:web:2aa4c11c3f5dd1d15f0882"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const urlParams = new URLSearchParams(window.location.search);
const videoId = urlParams.get('id');
const playerContainer = document.getElementById('playerContainer');
const videoTitle = document.getElementById('videoTitle');
const videoViews = document.getElementById('videoViews');

if(videoId){
  const videoRef = db.ref('videos/'+videoId);
  videoRef.once('value').then(snapshot=>{
    const data = snapshot.val();
    if(data){
      let embedHTML = '';
      // تحديد نوع الفيديو
      if(data.video.includes("youtube.com") || data.video.includes("youtu.be")){
        let vid="";
        if(data.video.includes("youtube.com/watch?v=")){
          vid = data.video.split("v=")[1].split("&")[0];
        } else if(data.video.includes("youtu.be/")){
          vid = data.video.split("youtu.be/")[1].split("?")[0];
        }
        embedHTML = `<iframe src="https://www.youtube.com/embed/${vid}" frameborder="0"
                      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                      allowfullscreen></iframe>`;
      } else {
        embedHTML = `<video src="${data.video}" controls autoplay></video>`;
      }
      playerContainer.innerHTML = embedHTML;
      videoTitle.innerText = data.title;
      videoViews.innerText = data.views || 0;

      // زيادة عدد المشاهدات
      videoRef.child('views').transaction(current=>(current||0)+1)
        .then(()=> videoRef.child('views').once('value')
        .then(snap=>{ videoViews.innerText=snap.val(); }));
    } else videoTitle.innerText='الفيديو غير موجود';
  });
} else videoTitle.innerText='لم يتم تحديد فيديو';
</script>

</body>
</html>
