<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>لوحة إدارة أعضاء VIBE Studio</title>

<style>
body{background:#08090d;color:white;font-family:'Cairo',sans-serif;text-align:center;margin:0}
h2{margin-top:15px}
.form{background:#0f1118;padding:15px;width:92%;max-width:750px;margin:15px auto;border-radius:16px}
input,select{width:100%;padding:9px;margin-bottom:10px;border-radius:10px;border:0}
button{width:100%;padding:10px;border-radius:10px;border:0;cursor:pointer}
.add{background:#16c784}
.update{background:#3399ff}
.delete{background:#ff3b3b}
.member-item{background:#0f1118;margin:10px auto;padding:10px;width:92%;max-width:750px;border-radius:12px}
</style>
</head>

<body>

<h2>لوحة إدارة الأعضاء</h2>

<div class="form">

  <label>صورة العضو</label>
  <input type="file" id="image">

  <label>اسم العضو</label>
  <input type="text" id="name">

  <label>المهنة</label>
  <select id="role">
    <option>مغني</option>
    <option>ملحن</option>
    <option>موزع موسيقي</option>
    <option>دي جي</option>
    <option>مهندس صوت</option>
    <option>كاتب أغاني</option>
    <option>مشرف مسرح</option>
    <option>عازف</option>
  </select>

  <label>خانة إضافية (اختياري)</label>
  <input type="text" id="extra" placeholder="مثال: عازف بيانو - قائد الفريق">

  <label>
    <input type="checkbox" id="featuredCheck">
    عضو مميز ⭐
  </label>

  <button class="add" id="addBtn">إضافة عضو</button>

</div>

<div id="members"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAYcZ2_RjaI4fjP14QlqbUbL3rWvPPWnas",
  authDomain: "sheko-store.firebaseapp.com",
  databaseURL: "https://sheko-store-default-rtdb.firebaseio.com",
  projectId: "sheko-store",
  storageBucket: "sheko-store.appspot.com",
  messagingSenderId: "113892775847",
  appId: "1:113892775847:web:2aa4c11c3f5dd1d15f0882"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let editKey = null;

function getFile(file){
  return new Promise(res=>{
    let r = new FileReader();
    r.onload=()=>res(r.result);
    r.readAsDataURL(file);
  });
}

document.getElementById("addBtn").onclick = async ()=>{
  if(editKey) return saveEdit();
  addMember();
};

async function addMember(){

  let name = nameInput.value.trim();
  let role = roleInput.value;
  let extra = extraInput.value.trim();
  let featured = featuredCheck.checked;
  let file = image.files[0];

  if(!name || !file){
    alert("اكتب الاسم وارفع صورة");
    return;
  }

  let img = await getFile(file);

  let ref = db.ref("vibeMembers").push();
  ref.set({
    key: ref.key,
    name,
    role,
    extra,
    featured,
    image: img,
    time: Date.now()
  }).then(()=>{
    alert("تم إضافة العضو");
    clearForm();
  });
}

function clearForm(){
  nameInput.value="";
  extraInput.value="";
  image.value="";
  featuredCheck.checked=false;
  addBtn.innerText="إضافة عضو";
  editKey=null;
}

const nameInput=document.getElementById("name");
const roleInput=document.getElementById("role");
const extraInput=document.getElementById("extra");
const featuredCheck=document.getElementById("featuredCheck");
const addBtn=document.getElementById("addBtn");

// عرض
db.ref("vibeMembers").on("value",snap=>{
  members.innerHTML="";
  let list=[];
  snap.forEach(c=>list.push(c.val()));
  list.reverse();

  list.forEach(m=>{
    members.innerHTML += `
      <div class="member-item">
        <b>${m.name}</b><br>
        ${m.role}${m.extra?" - "+m.extra:""}<br>
        ${m.featured?"⭐ عضو مميز":"عضو عادي"}
        <br><br>
        <button class="update" onclick='loadEdit("${m.key}")'>تعديل</button>
        <button class="delete" onclick='deleteMember("${m.key}")'>حذف</button>
      </div>
    `;
  });
});

function deleteMember(key){
  if(confirm("حذف العضو؟"))
  db.ref("vibeMembers/"+key).remove();
}

function loadEdit(key){
  editKey=key;
  db.ref("vibeMembers/"+key).once("value").then(s=>{
    let m=s.val();
    nameInput.value=m.name;
    roleInput.value=m.role;
    extraInput.value=m.extra||"";
    featuredCheck.checked=m.featured;
    addBtn.innerText="حفظ التعديل";
  });
}

async function saveEdit(){
  let updateData={
    name:nameInput.value,
    role:roleInput.value,
    extra:extraInput.value,
    featured:featuredCheck.checked
  };

  let file=image.files[0];
  if(file) updateData.image=await getFile(file);

  db.ref("vibeMembers/"+editKey).update(updateData).then(()=>{
    alert("تم التعديل");
    clearForm();
  });
}
</script>

</body>
</html>
