<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>غرف الدردشة - Sheko Store</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Cairo', sans-serif; background: #f9f9f9; margin: 0; padding: 20px; }
    h1 { text-align: center; color: #222; }
    .room-list { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
    .room { background: white; border-radius: 10px; padding: 15px; box-shadow: 0 0 8px rgba(0,0,0,0.05); position: relative; cursor: pointer; }
    .room:hover { background: #fffcf2; }
    .room-title { font-size: 18px; font-weight: bold; color: #333; }
    .room-info { font-size: 14px; color: #777; margin-top: 5px; }
    .create-btn {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #ffb700;
      color: #222;
      font-size: 22px;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 10px rgba(0,0,0,0.15);
      cursor: pointer;
    }
    .create-btn:hover { background: #ffd44d; }
    #createModal {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      z-index: 9999;
      width: 90%;
      max-width: 400px;
    }
    #createModal input, #createModal select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    #createModal button {
      width: 100%;
      padding: 10px;
      background: #222;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
    }
    #createModal button:hover { background: #ffb700; color: #222; }
  </style>
</head>
<body>
  <h1>كل غرف الدردشة</h1>
  <div class="room-list" id="roomList"></div>  <button class="create-btn" onclick="toggleModal()">
    <i class="fa fa-plus"></i>
  </button>  <div id="createModal">
    <h3 style="text-align:center;">إنشاء غرفة دردشة جديدة</h3>
    <input type="text" id="roomName" placeholder="اسم الغرفة">
    <select id="roomLanguage">
      <option value="">اختر اللغة</option>
      <option value="العربية">العربية</option>
      <option value="الإنجليزية">الإنجليزية</option>
      <option value="الفرنسية">الفرنسية</option>
    </select>
    <select id="roomFlag">
      <option value="">اختر الدولة</option>
      <option value="🇪🇬">🇪🇬 مصر</option>
      <option value="🇸🇦">🇸🇦 السعودية</option>
      <option value="🇲🇦">🇲🇦 المغرب</option>
      <option value="🇺🇸">🇺🇸 أمريكا</option>
    </select>
    <input type="text" id="roomImage" placeholder="رابط صورة الغرفة (اختياري)">
    <button onclick="createRoom()">إنشاء الغرفة مقابل 50 جنيه</button>
  </div>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAYcZ2_RjaI4fjP14QlqbUbL3rWvPPWnas",
      authDomain: "sheko-store.firebaseapp.com",
      databaseURL: "https://sheko-store-default-rtdb.firebaseio.com",
      projectId: "sheko-store",
      storageBucket: "sheko-store.appspot.com",
      messagingSenderId: "113892775847",
      appId: "1:113892775847:web:2aa4c11c3f5dd1d15f0882"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();
    let currentUser;

    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        loadRooms();
      } else {
        window.location.href = "login.html";
      }
    });

    function toggleModal() {
      const modal = document.getElementById("createModal");
      modal.style.display = modal.style.display === "none" ? "block" : "none";
    }

    function loadRooms() {
      db.ref("chat_rooms").on("value", snapshot => {
        const roomList = document.getElementById("roomList");
        roomList.innerHTML = "";
        const data = snapshot.val();
        for (const id in data) {
          const room = data[id];
          const users = room.users || {};
          const userCount = Object.keys(users).length;
          roomList.innerHTML += `
            <div class="room" onclick="enterRoom('${id}', '${room.adminUid}')">
              <div class="room-title">${room.name} ${room.flag || ''}</div>
              <div class="room-info">اللغة: ${room.language || 'غير محددة'} - عدد الأعضاء: ${userCount}</div>
            </div>
          `;
        }
      });
    }

    function createRoom() {
      const name = document.getElementById("roomName").value.trim();
      const lang = document.getElementById("roomLanguage").value;
      const flag = document.getElementById("roomFlag").value;
      const img = document.getElementById("roomImage").value.trim();
      if (!name || !lang || !flag) return alert("يرجى تعبئة كل الحقول الأساسية");

      const uid = currentUser.uid;
      db.ref("users/" + uid + "/balance").once("value").then(snap => {
        let balance = snap.val() || 0;
        if (balance < 50) return alert("رصيدك غير كافٍ");

        db.ref("users/" + uid + "/balance").set(balance - 50);
        const newRoom = db.ref("chat_rooms").push();
        newRoom.set({
          name, language: lang, flag,
          adminUid: uid,
          requestedImage: img,
          approvedImage: "",
          users: {
            [uid]: true
          }
        });
        alert("تم إنشاء الغرفة بنجاح");
        toggleModal();
      });
    }

    function enterRoom(roomId, adminId) {
      const uid = currentUser.uid;
      if (uid === adminId) {
        window.location.href = `Private-chat-room.html?id=${roomId}`;
      } else {
        alert("لا يمكنك الدخول لهذه الغرفة إلا بعد قبول الدعوة");
      }
    }
  </script></body>
</html>
