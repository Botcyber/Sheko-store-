<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ÙƒÙ„ ØºØ±Ù Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© - Sheko Store</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    body { font-family: 'Cairo', sans-serif; background: #f1f1f1; margin: 0; padding: 20px; }
    h1 { text-align: center; }
    #createRoomBtn, #myRoomsBtn {
      position: fixed; top: 20px;
      font-size: 30px; cursor: pointer; background: #222; color: #fff;
      width: 50px; height: 50px; border-radius: 50%; display: flex; justify-content: center; align-items: center;
      box-shadow: 0 0 10px #000;
      z-index: 1000;
    }
    #createRoomBtn { left: 20px; }
    #myRoomsBtn { right: 20px; }
    .modal {
      display: none;
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center; align-items: center;
      z-index: 1100;
    }
    .modal .modal-content {
      background: white; padding: 20px; border-radius: 10px; width: 320px; position: relative;
    }
    .modal input, .modal select {
      width: 100%; margin: 10px 0; padding: 8px; border-radius: 5px; border: 1px solid #ccc;
    }
    .modal button {
      background: #222; color: white; padding: 10px; width: 100%; border: none; border-radius: 5px; font-weight: bold;
      cursor: pointer;
    }
    .modal button:hover { background: #ffb700; color: #222; }
    .modal .close-btn {
      position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 20px;
    }
    .room {
      background: white; border-radius: 10px; padding: 15px; margin-bottom: 15px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1); cursor: pointer; display: flex; align-items: center;
    }
    .room img {
      width: 50px; height: 50px; border-radius: 8px; margin-left: 10px;
      object-fit: cover;
    }
    .room-info { flex-grow: 1; }
    .room-name { font-weight: bold; font-size: 18px; }
    .room-meta { font-size: 14px; color: #555; }
    .invited-label {
      background: orange; color: white; font-size: 12px; padding: 2px 5px; border-radius: 5px;
      margin-right: 10px;
    }
    #searchInput { width: 100%; padding: 10px; margin: 10px 0; border-radius: 6px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h1>ÙƒÙ„ ØºØ±Ù Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</h1>  <div id="createRoomBtn" title="Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø©"><i class="fa fa-plus"></i></div>
  <div id="myRoomsBtn" title="ØºØ±ÙÙŠ"><i class="fa fa-user"></i></div>  <!-- Ù†Ø§ÙØ°Ø© Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© -->  <div id="createRoomModal" class="modal">
    <div class="modal-content">
      <div class="close-btn" onclick="createRoomModal.style.display='none'">&times;</div>
      <h3>Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù‚Ø§Ø¨Ù„ 50 Ø¬Ù†ÙŠÙ‡</h3>
      <input type="text" id="roomName" placeholder="Ø§Ø³Ù… Ø§Ù„ØºØ±ÙØ©" />
      <select id="language">
        <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ©</option>
        <option>Ø¹Ø±Ø¨ÙŠØ©</option><option>Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</option><option>ÙØ±Ù†Ø³ÙŠØ©</option><option>Ø¥Ø³Ø¨Ø§Ù†ÙŠØ©</option><option>ØªØ±ÙƒÙŠØ©</option><option>Ø£Ù„Ù…Ø§Ù†ÙŠØ©</option><option>Ø£Ø®Ø±Ù‰</option>
      </select>
      <select id="country">
        <option value="" disabled selected>Ø§Ø®ØªØ± Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯ÙˆÙ„Ø©</option>
        <option value="ğŸ‡ªğŸ‡¬">ğŸ‡ªğŸ‡¬ Ù…ØµØ±</option>
        <option value="ğŸ‡¸ğŸ‡¦">ğŸ‡¸ğŸ‡¦ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
        <option value="ğŸ‡¦ğŸ‡ª">ğŸ‡¦ğŸ‡ª Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª</option>
        <option value="ğŸ‡©ğŸ‡¿">ğŸ‡©ğŸ‡¿ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</option>
        <option value="ğŸ‡²ğŸ‡¦">ğŸ‡²ğŸ‡¦ Ø§Ù„Ù…ØºØ±Ø¨</option>
        <option value="ğŸ‡±ğŸ‡§">ğŸ‡±ğŸ‡§ Ù„Ø¨Ù†Ø§Ù†</option>
        <option value="ğŸ‡¯ğŸ‡´">ğŸ‡¯ğŸ‡´ Ø§Ù„Ø£Ø±Ø¯Ù†</option>
      </select>
      <input type="file" id="roomImage" accept="image/*" />
      <button id="createRoomConfirmBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©</button>
    </div>
  </div>  <!-- Ù†Ø§ÙØ°Ø© ØºØ±ÙÙŠ -->  <div id="myRoomsModal" class="modal">
    <div class="modal-content">
      <div class="close-btn" onclick="myRoomsModal.style.display='none'">&times;</div>
      <h3>ØºØ±ÙÙŠ</h3>
      <input type="text" id="searchMyRooms" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ØºØ±ÙØ©..." />
      <div id="myRoomsList"></div>
    </div>
  </div>  <div id="roomsContainer"></div>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAYcZ2_RjaI4fjP14QlqbUbL3rWvPPWnas",
      authDomain: "sheko-store.firebaseapp.com",
      databaseURL: "https://sheko-store-default-rtdb.firebaseio.com",
      projectId: "sheko-store",
      storageBucket: "sheko-store.appspot.com",
      messagingSenderId: "113892775847",
      appId: "1:113892775847:web:2aa4c11c3f5dd1d15f0882"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    let currentUser;
    const createRoomModal = document.getElementById("createRoomModal");
    const myRoomsModal = document.getElementById("myRoomsModal");

    auth.onAuthStateChanged(user => {
      if (!user) return location.href = "login.html";
      currentUser = user;
      loadRooms();
    });

    document.getElementById("createRoomBtn").onclick = () => createRoomModal.style.display = "flex";
    document.getElementById("myRoomsBtn").onclick = () => {
      myRoomsModal.style.display = "flex";
      loadMyRooms();
    };

    document.getElementById("createRoomConfirmBtn").onclick = async () => {
      const name = document.getElementById("roomName").value.trim();
      const language = document.getElementById("language").value;
      const flag = document.getElementById("country").value;
      const file = document.getElementById("roomImage").files[0];
      if (!name || !language || !flag) return alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„.");
      const balSnap = await db.ref("users/" + currentUser.uid + "/balance").once("value");
      const balance = balSnap.val() || 0;
      if (balance < 50) return alert("Ø±ØµÙŠØ¯Ùƒ Ù„Ø§ ÙŠÙƒÙÙŠ.");
      await db.ref("users/" + currentUser.uid + "/balance").set(balance - 50);
      const imgUrl = file ? URL.createObjectURL(file) : "";
      const roomRef = db.ref("chat_rooms").push();
      await roomRef.set({ name, language, flag, adminUid: currentUser.uid, requestedImage: imgUrl, approvedImage: "", users: { [currentUser.uid]: { name: "Ø£Ù†Øª" } } });
      alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©.");
      createRoomModal.style.display = "none";
    };

    function loadRooms() {
      db.ref("chat_rooms").on("value", snap => {
        const rooms = snap.val() || {};
        const container = document.getElementById("roomsContainer");
        container.innerHTML = "";
        for (const id in rooms) {
          const r = rooms[id];
          const isMember = r.users && r.users[currentUser.uid];
          const div = document.createElement("div");
          div.className = "room";
          div.innerHTML = `<img src="${r.approvedImage || 'default-room.png'}"><div class='room-info'><div class='room-name'>${r.name} ${r.flag || ''}</div><div class='room-meta'>Ø§Ù„Ù„ØºØ©: ${r.language || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'} - Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡: ${r.users ? Object.keys(r.users).length : 0}</div></div>`;
          if (isMember) div.onclick = () => location.href = `Private-chat-room.html?roomId=${id}`;
          container.appendChild(div);
        }
      });
    }

    function loadMyRooms() {
      db.ref("chat_rooms").once("value").then(snap => {
        const rooms = snap.val() || {};
        const myList = document.getElementById("myRoomsList");
        const searchInput = document.getElementById("searchMyRooms");
        myList.innerHTML = "";
        for (const id in rooms) {
          const r = rooms[id];
          if (r.users && r.users[currentUser.uid]) {
            const btn = document.createElement("div");
            btn.style.cssText = "padding:10px; margin:5px 0; border:1px solid #ccc; border-radius:6px; cursor:pointer";
            btn.textContent = r.name + ' ' + (r.flag || '');
            btn.onclick = () => location.href = `Private-chat-room.html?roomId=${id}`;
            myList.appendChild(btn);
          }
        }
        searchInput.oninput = () => {
          const val = searchInput.value.toLowerCase();
          [...myList.children].forEach(d => d.style.display = d.textContent.toLowerCase().includes(val) ? "block" : "none");
        };
      });
    }
  </script></body>
</html>
