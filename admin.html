<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة تحكم الأدمن - Sheko Store</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: 'Cairo', sans-serif; background: #f1f1f1; padding: 20px; }
    .section { background: white; border-radius: 12px; padding: 20px; margin-bottom: 30px; }
    label, input, button, select { display: block; width: 100%; margin: 10px 0; padding: 10px; border-radius: 5px; }
    button { background: #222; color: white; cursor: pointer; }
    h2 { margin-bottom: 10px; }
    ul { list-style: none; padding: 0; }
    li { background: #eee; margin: 10px 0; padding: 10px; border-radius: 8px; }
  </style>
</head>
<body>

  <div class="section">
    <h2>طلب تعديل رصيد أو نقاط</h2>
    <label>UID المستخدم:</label>
    <input type="text" id="targetUid" placeholder="اكتب UID هنا">
    <label>الرصيد:</label>
    <input type="number" id="amount" placeholder="أدخل القيمة">
    <select id="action">
      <option value="add_balance">إضافة رصيد</option>
      <option value="subtract_balance">خصم رصيد</option>
      <option value="add_points">إضافة نقاط</option>
      <option value="subtract_points">خصم نقاط</option>
    </select>
    <button onclick="updateUser()">تنفيذ العملية</button>
    <p id="adminMsg"></p>
  </div>

  <div class="section">
    <h2>الطلبات الواردة</h2>
    <ul id="ordersList">تحميل الطلبات...</ul>
  </div>

  <div class="section">
    <h2>إضافة مستخدم يدويًا</h2>
    <label>UID المستخدم:</label>
    <input type="text" id="manualUID" placeholder="مثلاً: abc123456">
    <label>البريد الإلكتروني (اختياري):</label>
    <input type="email" id="manualEmail" placeholder="example@email.com">
    <label>الرصيد المبدئي:</label>
    <input type="number" id="manualBalance" placeholder="مثلاً 0">
    <label>النقاط المبدئية:</label>
    <input type="number" id="manualPoints" placeholder="مثلاً 0">
    <button onclick="addManualUser()">إضافة المستخدم</button>
    <p id="manualUserMsg"></p>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAYcZ2_RjaI4fjP14QlqbUbL3rWvPPWnas",
      authDomain: "sheko-store.firebaseapp.com",
      projectId: "sheko-store",
      storageBucket: "sheko-store.firebasestorage.app",
      messagingSenderId: "113892775847",
      appId: "1:113892775847:web:2aa4c11c3f5dd1d15f0882"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // تنفيذ أوامر على المستخدم
    function updateUser() {
      const uid = document.getElementById("targetUid").value.trim();
      const amount = parseFloat(document.getElementById("amount").value);
      const action = document.getElementById("action").value;
      const msg = document.getElementById("adminMsg");

      if (!uid || isNaN(amount)) return msg.textContent = "يرجى ملء البيانات بشكل صحيح";

      const field = action.includes("balance") ? "balance" : "points";
      const change = action.includes("add") ? amount : -amount;

      db.collection("users").doc(uid).update({
        [field]: firebase.firestore.FieldValue.increment(change)
      }).then(() => {
        msg.style.color = "green";
        msg.textContent = "✅ تم التحديث بنجاح";
      }).catch(err => {
        msg.style.color = "red";
        msg.textContent = "❌ خطأ: " + err.message;
      });
    }

    // تحميل الطلبات
    db.collection("orders").orderBy("createdAt", "desc").onSnapshot(snapshot => {
      const ordersList = document.getElementById("ordersList");
      ordersList.innerHTML = "";
      if (snapshot.empty) {
        ordersList.innerHTML = "<li>لا توجد طلبات حالياً</li>";
        return;
      }

      snapshot.forEach(doc => {
        const data = doc.data();
        const item = document.createElement("li");
        item.innerHTML = `
          <strong>UID:</strong> ${data.uid}<br>
          <strong>الخدمة:</strong> ${data.service}<br>
          <strong>الباقة:</strong> ${data.package}<br>
          <strong>الحساب:</strong> ${data.account}<br>
          <strong>الحالة:</strong> ${data.status || "قيد التنفيذ"}<br>
          <strong>التاريخ:</strong> ${data.createdAt?.toDate().toLocaleString() || "غير متوفر"}
        `;
        ordersList.appendChild(item);
      });
    });

    // إضافة مستخدم يدويًا
    function addManualUser() {
      const uid = document.getElementById("manualUID").value.trim();
      const email = document.getElementById("manualEmail").value.trim();
      const balance = parseFloat(document.getElementById("manualBalance").value || "0");
      const points = parseFloat(document.getElementById("manualPoints").value || "0");
      const msg = document.getElementById("manualUserMsg");

      if (!uid) {
        msg.style.color = "red";
        msg.textContent = "يرجى إدخال UID";
        return;
      }

      db.collection("users").doc(uid).set({
        email: email || "",
        balance: balance,
        points: points
      }).then(() => {
        msg.style.color = "green";
        msg.textContent = "✅ تم إضافة المستخدم بنجاح!";
      }).catch((error) => {
        msg.style.color = "red";
        msg.textContent = "❌ فشل في الإضافة: " + error.message;
      });
    }
  </script>
</body>
</html>
