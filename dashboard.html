<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>لوحة التحكم - Sheko Store</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- ربط Font Awesome للأيقونات -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      margin: 0;
      background: #f1f1f1;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #222;
      padding: 10px 20px;
      color: white;
      flex-wrap: wrap;
    }
    .nav-icons {
      display: flex;
      gap: 25px;
    }
    .nav-icons a {
      color: white;
      text-decoration: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-size: 14px;
      transition: color 0.3s ease;
    }
    .nav-icons a i {
      font-size: 20px;
      margin-bottom: 4px;
    }
    .nav-icons a:hover {
      color: #ffb700;
    }
    .user-area {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 15px;
    }
    #balance {
      font-weight: bold;
    }
    button {
      background: #444;
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: bold;
      transition: background 0.3s ease;
      font-size: 14px;
    }
    button i {
      font-size: 16px;
    }
    button:hover {
      background: #ffb700;
      color: #222;
    }
    .dashboard {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      margin-top: 30px;
    }
    label, select, input {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button.order-btn {
      background: #222;
      color: white;
      padding: 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
      margin-top: 15px;
      font-weight: bold;
    }
    button.order-btn:hover {
      background: #444;
    }
    .note {
      font-size: 14px;
      color: #666;
      text-align: center;
      margin-top: 20px;
    }
    @media (max-width: 600px) {
      .nav-icons {
        gap: 15px;
      }
      .nav-icons a span {
        font-size: 12px;
      }
      .nav-icons a i {
        font-size: 18px;
      }
      button, button.order-btn {
        padding: 6px 10px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>

<div class="top-bar">
  <nav class="nav-icons">
    <a href="account.html" title="معلومات حسابك">
      <i class="fa fa-user"></i>
      <span>حسابك</span>
    </a>
    <a href="orders.html" title="طلباتك">
      <i class="fa fa-box"></i>
      <span>طلباتك</span>
    </a>
    <a href="add-money.html" title="إضافة أموال">
      <i class="fa fa-wallet"></i>
      <span>إضافة أموال</span>
    </a>
    <a href="reviews_complaints.html" title="التقييمات والشكاوي">
      <i class="fa fa-comments"></i>
      <span>التقييمات والشكاوي</span>
    </a>
    <!-- زر الاشعارات -->
    <a href="notifications.html" title="الإشعارات">
      <i class="fa fa-bell"></i>
      <span>الإشعارات</span>
    </a>
  </nav>

  <div class="user-area">
    <span id="balance">رصيدك: ...</span>
    <button onclick="logout()" title="تسجيل الخروج">
      <i class="fa fa-sign-out-alt"></i> خروج
    </button>
  </div>
</div>

<div class="dashboard">
  <h2>إرسال طلب</h2>
  <label for="mainService">نوع الخدمة:</label>
  <select id="mainService">
    <option value="">اختر نوع الخدمة</option>
    <option value="ألعاب">شحن ألعاب</option>
    <option value="سوشيال">مواقع التواصل</option>
  </select>

  <label for="subService">الخدمة:</label>
  <select id="subService"></select>

  <label for="package">الباقة:</label>
  <select id="package"></select>

  <label for="accountInput">اسم الحساب / ID:</label>
  <input type="text" id="accountInput" />

  <button class="order-btn" onclick="submitOrder()">إرسال الطلب</button>
  <p class="note">إذا واجهت أي مشكلة، راسلنا على واتساب: 01099874914</p>
</div>

<!-- Firebase Scripts -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAYcZ2_RjaI4fjP14QlqbUbL3rWvPPWnas",
  authDomain: "sheko-store.firebaseapp.com",
  databaseURL: "https://sheko-store-default-rtdb.firebaseio.com",
  projectId: "sheko-store",
  storageBucket: "sheko-store.firebasestorage.app",
  messagingSenderId: "113892775847",
  appId: "1:113892775847:web:2aa4c11c3f5dd1d15f0882"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let currentUser = null;
const prices = {
  "ألعاب": {
    "ببجي موبايل": {"60 شدة": 50, "300 شدة": 250},
    "كود موبايل": {"220 CP": 250},
    "فري فاير": {"100 جوهرة": 70},
    "فيفا موبايل": {"20 كوينز": 40}
  },
  "سوشيال": {
    "تيك توك": {"1000 متابع": 50},
    "يوتيوب": {"1000 مشترك": 50},
    "انستجرام": {"1000 متابع": 50}
  }
};

const mainService = document.getElementById("mainService");
const subService = document.getElementById("subService");
const packageEl = document.getElementById("package");
const accountInput = document.getElementById("accountInput");
const balanceEl = document.getElementById("balance");

mainService.addEventListener("change", () => {
  subService.innerHTML = "";
  packageEl.innerHTML = "";
  const selectedMain = prices[mainService.value];
  if (!selectedMain) return;
  for (let sub in selectedMain) {
    let opt = document.createElement("option");
    opt.value = sub;
    opt.textContent = sub;
    subService.appendChild(opt);
  }
  updatePackage();
});

subService.addEventListener("change", updatePackage);
function updatePackage() {
  packageEl.innerHTML = "";
  const selected = prices[mainService.value]?.[subService.value];
  if (!selected) return;
  for (let pkg in selected) {
    let opt = document.createElement("option");
    opt.value = pkg;
    opt.textContent = `${pkg} - ${selected[pkg]} جنيه`;
    packageEl.appendChild(opt);
  }
}

auth.onAuthStateChanged(user => {
  if (!user) return location.href = "index.html";
  currentUser = user;

  db.ref("users/" + user.uid + "/balance").on("value", snapshot => {
    const balance = snapshot.val();
    balanceEl.textContent = `رصيدك: ${balance !== null ? balance : 0} جنيه`;
  });
});

function submitOrder() {
  const service = mainService.value;
  const sub = subService.value;
  const pack = packageEl.value;
  const account = accountInput.value.trim();
  const cost = prices[service]?.[sub]?.[pack];

  if (!service || !sub || !pack || !account) return alert("يرجى ملء جميع الحقول");
  if (cost === undefined) return alert("لا يمكن تحديد تكلفة الخدمة");

  db.ref("users/" + currentUser.uid + "/balance").once("value").then(snapshot => {
    const balance = snapshot.val() || 0;
    if (balance < cost) return alert("رصيدك لا يكفي لإتمام هذا الطلب");

    const order = {
      uid: currentUser.uid,
      type: service,
      service: sub,
      package: pack,
      account: account,
      status: "قيد التنفيذ",
      createdAt: new Date().toISOString()
    };

    const ordersRef = db.ref("orders");
    const newOrderRef = ordersRef.push();

    newOrderRef.set(order).then(() => {
      return db.ref("users/" + currentUser.uid).update({
        balance: balance - cost
      });
    }).then(() => {
      alert("تم إرسال الطلب وخصم الرصيد بنجاح");
      mainService.value = "";
      subService.innerHTML = "";
      packageEl.innerHTML = "";
      accountInput.value = "";
    }).catch(err => {
      console.error(err);
      alert("حدث خطأ أثناء إرسال الطلب");
    });
  });
}

function logout() {
  auth.signOut().then(() => {
    location.href = "index.html";
  });
}
</script>

</body>
</html>
