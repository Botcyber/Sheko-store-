<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>لوحة التحكم - Sheko Store</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body { font-family: 'Cairo', sans-serif; margin: 0; background: #f1f1f1; }
    .top-bar { display: flex; justify-content: space-between; align-items: center; background: #222; padding: 10px 20px; color: white; flex-wrap: wrap; }
    .nav-icons { display: flex; gap: 25px; flex-direction: column; }
    .nav-icons a { color: white; text-decoration: none; display: flex; flex-direction: row; align-items: center; font-size: 14px; position: relative; transition: color 0.3s ease; gap: 8px; }
    .nav-icons a i { font-size: 20px; margin: 0; }
    .nav-icons a:hover { color: #ffb700; }
    #notifBadge, #chatBadge {
      position: absolute;
      top: 0;
      left: 5px;
      background: red;
      color: white;
      font-size: 12px;
      font-weight: bold;
      border-radius: 50%;
      padding: 2px 6px;
      display: none;
      transform: translate(-50%, 50%);
      user-select: none;
      pointer-events: none;
    }
    .user-area { display: flex; align-items: center; gap: 15px; font-size: 15px; }
    #balance { font-weight: bold; }
    button { background: #444; border: none; color: white; padding: 8px 15px; border-radius: 5px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-weight: bold; transition: background 0.3s ease; font-size: 14px; }
    button i { font-size: 16px; }
    button:hover { background: #ffb700; color: #222; }
    .dashboard { max-width: 800px; margin: auto; padding: 20px; background: white; border-radius: 12px; margin-top: 30px; position: relative; }
    label, select, input { display: block; width: 100%; margin: 10px 0; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
    button.order-btn { background: #222; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 15px; font-weight: bold; }
    button.order-btn:hover { background: #444; }
    .note { font-size: 14px; color: #666; text-align: center; margin-top: 20px; }
    .footer-contact { max-width: 800px; margin: 30px auto 20px; text-align: center; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
    .btn-share, .btn-copy { background: #222; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-weight: bold; cursor: pointer; transition: background 0.3s ease; min-width: 180px; }
    .btn-share:hover, .btn-copy:hover { background: #ffb700; color: #222; }
  </style>
</head>
<body>
<div class="top-bar">
  <nav class="nav-icons">
    <a href="account.html"><i class="fa fa-user"></i><span>حسابك</span></a>
    <a href="orders.html"><i class="fa fa-box"></i><span>طلباتك</span></a>
    <a href="add-money.html"><i class="fa fa-wallet"></i><span>إضافة أموال</span></a>
    <a href="reviews_complaints.html"><i class="fa fa-comments"></i><span>التقييمات</span></a>
    <a href="notifications.html" style="position: relative;">
      <i class="fa fa-bell"></i><span>الإشعارات</span><span id="notifBadge">0</span>
    </a>
    <a href="ranking.html"><i class="fa fa-crown"></i><span>التصنيف</span></a>
    <a href="vote-event.html"><i class="fa fa-bolt"></i><span>الفعاليات</span></a>
    <a href="support_chat.html"><i class="fa fa-headset"></i><span>فريق الدعم والشكاوى</span></a>
    <a href="wheel.html"><i class="fa fa-dharmachakra"></i><span>عجلة الحظ</span></a>
    <a href="chat.html" id="chatLink" style="position: relative;">
      <i class="fa fa-comments"></i><span>الدردشة</span><span id="chatBadge">0</span>
    </a>
    <!-- زر الأخبار -->
    <a href="news.html" style="display: flex; align-items: center; gap: 5px; color: white; text-decoration: none;">
      <i class="fa fa-newspaper"></i>
      <span>الأخبار</span>
    </a>
  </nav>
  <div class="user-area">
    <span id="balance">رصيدك: ...</span>
    <button onclick="logout()"><i class="fa fa-sign-out-alt"></i> خروج</button>
  </div>
</div>
<div class="dashboard">
  <h2>إرسال طلب</h2>
  <label for="mainService">نوع الخدمة:</label>
  <select id="mainService">
    <option value="">اختر نوع الخدمة</option>
    <option value="ألعاب">شحن ألعاب</option>
    <option value="سوشيال">مواقع التواصل</option>
    <option value="الشحن الالكتروني">الشحن الالكتروني</option>
  </select>
  <label for="subService">الخدمة:</label>
  <select id="subService"></select>
  <label for="package">الباقة:</label>
  <select id="package"></select>
  <label for="accountInput" id="accountLabel">اسم الحساب / ID:</label>
  <input type="text" id="accountInput" />
  <button class="order-btn" onclick="submitOrder()">إرسال الطلب</button>
  <p class="note">إذا واجهت أي مشكلة، راسلنا على واتساب: 01099874914</p>
</div>
<div class="footer-contact">
  <button class="btn-share" onclick="shareSite()">مشاركة الموقع مع أصدقائك</button>
  <button class="btn-copy" onclick="copyLink()">نسخ رابط الموقع</button>
</div>

<!-- تنبيه مخصص -->
<div id="customAlert" style="
  display:none;
  position: fixed;
  top: 30%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 0 15px rgba(0,0,0,0.4);
  padding: 20px 30px;
  max-width: 320px;
  text-align: center;
  font-weight: bold;
  font-size: 17px;
  z-index: 9999;
  color: #222;
">
  <i id="alertIcon" class="fa fa-info-circle" style="color: #007bff; font-size: 28px; margin-bottom: 10px;"></i>
  <div id="alertText" style="margin-bottom: 15px;"></div>
  <button onclick="hideCustomAlert()" style="
    background: #ffb700;
    border: none;
    padding: 8px 20px;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
    font-size: 15px;
    color: #222;
  ">حسناً</button>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
  // تهيئة Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyAYcZ2_RjaI4fjP14QlqbUbL3rWvPPWnas",
    authDomain: "sheko-store.firebaseapp.com",
    databaseURL: "https://sheko-store-default-rtdb.firebaseio.com",
    projectId: "sheko-store",
    storageBucket: "sheko-store.appspot.com",
    messagingSenderId: "113892775847",
    appId: "1:113892775847:web:2aa4c11c3f5dd1d15f0882"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();
  let currentUser = null;

  // الأسعار (نقلتها كما هي بدون تغيير)
  const prices = {
    "ألعاب": {
      "ببجي موبايل": {
        "60 شده": 50,
        "325 شده": 250,
        "660 شده": 500,
        "1800 شده": 1200
      },
      "كود موبايل": {
        "30 سي بي": 25,
        "88 سي بي": 60,
        "420 سي بي": 260,
        "880 سي بي": 500,
        "2400 سي بي": 1250
      },
      "فيفا موبايل": {
        "40 عمله": 25,
        "100 عمله": 60,
        "520 عمله": 300,
        "1070 عمله": 550
      },
      "فري فاير": {
        "50 جوهره": 30,
        "100 جوهره": 60,
        "200 جوهره": 120,
        "310 جوهره": 180,
        "520 جوهره": 300,
        "1060 جوهره": 550
      },
      "Delta Force": {
        "18 عمله": 20,
        "30 عمله": 30,
        "60 عمله": 55,
        "300 عمله": 250,
        "420 عمله": 350,
        "680 عمله": 500,
        "1280 عمله": 1000
      },
      "Valorant": {
        "475 عمله": 270,
        "1000 عمله": 530,
        "2050 عمله": 1000,
        "3650 عمله": 1800
      },
      "league of legends": {
        "575 ار بي": 260,
        "1380 ار بي": 600,
        "2800 ار بي": 1120,
        "4500 ار بي": 1900
      }
    },
    "سوشيال": {
      "تيك توك": {
        "1000 متابع بث مباشر": 40,
        "1000 متابع بدون بث": 100,
        "1000 مشاهده": 10,
        "1000 لايك": 20,
        "1000 الحفظ": 10,
        "1000 لايك في الكومنتات": 20,
        "1000 لايك في البث": 20,
        "1000 الاستوري": 30,
        "1000 مشاهدات استوري": 20,
        "1000 مشاركات استوري": 20,
        "1000 اكسبلور": 20,
        "1000 كومنتات بث": 20,
        "1000 مشاهدات بث": 40
      },
      "انستجرام": {
        "1000 لايك": 25,
        "1000 متابعين": 70,
        "1000 لايكات [عرب]": 40,
        "1000 مشاهدات استوري": 20,
        "1000 مشاهدات": 10,
        "1000 حفظ": 15,
        "1000 مشاركه": 10,
        "1000 لايكات في الكومنت": 190,
        "1000 مشاركه استوري": 30,
        "1000 مشاهدات بث": 90
      },
      "يوتيوب": {
        "1000 مشتركين": 150,
        "1000 كومنت": 130,
        "1000 لايكات": 30,
        "1000 مشاهدات حقيقي": 90,
        "1000 مشاهدات عاديه": 80,
        "1000 مشاركات المصدر فيسبوك": 70,
        "1000 لايكات فيديوهات قصيره": 60,
        "1000 مشاهدات فيديوهات قصيره": 100,
        "1000 تفاعل بث ايموجي": 30,
        "1000 مشاهدات بث ربع ساعه": 70,
        "1000 مشاهدات بث نص ساعه": 140,
        "1000 مشاهدات بث ساعه": 250
      }
    },
    "الشحن الالكتروني": {
      "كروت الفكه": {
        "كرت فودافون 15 جنيه": 15,
        "كرت فودافون 18 جنيه": 18,
        "كرت فودافون 22 جنيه": 22,
        "كرت فودافون 28 جنيه": 28,
        "كرت اورنج 15 جنيه": 15,
        "كرت اورنج 18 جنيه": 18,
        "كرت اورنج 22 جنيه": 22,
        "كرت اورنج 28 جنيه": 28,
        "كرت اورنج 40 جنيه": 40,
        "كرت اورنج 45 جنيه": 45,
        "كرت اورنج 55 جنيه": 55,
        "كرت اورنج 65 جنيه": 65,
        "كرت إتصالات 15 جنيه": 15,
        "كرت إتصالات 18 جنيه": 18,
        "كرت إتصالات 22 جنيه": 22,
        "كرت إتصالات 28 جنيه": 28,
        "كرت إتصالات 40 جنيه": 40,
        "كرت إتصالات 42 جنيه": 42,
        "كرت إتصالات 65 جنيه": 65
      }
    }
  };

  const mainService = document.getElementById("mainService");
  const subService = document.getElementById("subService");
  const packageEl = document.getElementById("package");
  const accountInput = document.getElementById("accountInput");
  const accountLabel = document.getElementById("accountLabel");
  const balanceEl = document.getElementById("balance");
  const notifBadge = document.getElementById("notifBadge");
  const chatBadge = document.getElementById("chatBadge");

  // تغيير الخدمات بناءً على النوع
  mainService.addEventListener("change", () => {
    subService.innerHTML = "";
    packageEl.innerHTML = "";
    const selectedMain = prices[mainService.value];
    if (!selectedMain) return;
    for (let sub in selectedMain) {
      let opt = document.createElement("option");
      opt.value = sub;
      opt.textContent = sub;
      subService.appendChild(opt);
    }
    updatePackage();

    // تغيير نص وعناصر الإدخال حسب النوع
    if (mainService.value === "ألعاب") {
      accountLabel.textContent = "ID فقط:";
      accountInput.placeholder = "أدخل رقم الـ ID فقط";
      accountInput.type = "tel";
      accountInput.pattern = "\\d*"; // أرقام فقط
      accountInput.title = "يرجى إدخال أرقام فقط";
    } else if (mainService.value === "سوشيال") {
      accountLabel.textContent = "رابط الحساب [متابعين-بث] او رابط الفيديو:";
      accountInput.placeholder = "أدخل الرابط";
      accountInput.type = "text";
      accountInput.removeAttribute("pattern");
      accountInput.removeAttribute("title");
    } else if (mainService.value === "الشحن الالكتروني") {
      accountLabel.textContent = "رقم هاتفك:";
      accountInput.placeholder = "أدخل رقم هاتفك";
      accountInput.type = "tel";
      accountInput.removeAttribute("pattern");
      accountInput.removeAttribute("title");
    } else {
      accountLabel.textContent = "اسم الحساب / ID:";
      accountInput.placeholder = "";
      accountInput.type = "text";
      accountInput.removeAttribute("pattern");
      accountInput.removeAttribute("title");
    }
  });

  subService.addEventListener("change", updatePackage);

  function updatePackage() {
    packageEl.innerHTML = "";
    const selected = prices[mainService.value]?.[subService.value];
    if (!selected) return;
    for (let pkg in selected) {
      let opt = document.createElement("option");
      opt.value = pkg;
      opt.textContent = `${pkg} - ${selected[pkg]} جنيه`;
      packageEl.appendChild(opt);
    }
  }

  // مراقبة حالة المصادقة والبيانات
  auth.onAuthStateChanged(user => {
    if (!user) return location.href = "index.html";
    currentUser = user;

    // تحديث الرصيد
    db.ref("users/" + user.uid + "/balance").on("value", snapshot => {
      const balance = snapshot.val();
      balanceEl.textContent = `رصيدك: ${balance !== null ? balance : 0} جنيه`;
    });

    // تحديث عداد الإشعارات
    db.ref("notifications/" + user.uid).on("value", snapshot => {
      const count = snapshot.numChildren();
      if (count > 0) {
        notifBadge.style.display = "inline-block";
        notifBadge.textContent = count > 99 ? "99+" : count;
      } else {
        notifBadge.style.display = "none";
        }
    });

    // تحديث عداد رسائل الدردشة الغير مقروءة
    db.ref(`chat-messages/${user.uid}/unreadCount`).on("value", snapshot => {
      const count = snapshot.val() || 0;
      if (count > 0) {
        chatBadge.style.display = "inline-block";
        chatBadge.textContent = count > 99 ? "99+" : count;
      } else {
        chatBadge.style.display = "none";
      }
    });
  });

  // دوال التنبيه المخصص
  function showCustomAlert(message, type = "info") {
    const alertBox = document.getElementById("customAlert");
    const alertText = document.getElementById("alertText");
    const alertIcon = document.getElementById("alertIcon");

    alertText.textContent = message;

    // تغيير لون الأيقونة حسب النوع
    alertIcon.className = "fa";
    if (type === "error") {
      alertIcon.classList.add("fa-times-circle");
      alertIcon.style.color = "#dc3545"; // أحمر
    } else if (type === "success") {
      alertIcon.classList.add("fa-check-circle");
      alertIcon.style.color = "#28a745"; // أخضر
    } else {
      alertIcon.classList.add("fa-info-circle");
      alertIcon.style.color = "#007bff"; // أزرق
    }

    alertBox.style.display = "block";
  }

  function hideCustomAlert() {
    document.getElementById("customAlert").style.display = "none";
  }

  // إرسال الطلب مع استخدام التنبيهات المخصصة بدل alert العادي
  function submitOrder() {
    const service = mainService.value;
    const sub = subService.value;
    const pack = packageEl.value;
    const account = accountInput.value.trim();
    const cost = prices[service]?.[sub]?.[pack];

    if (!service || !sub || !pack || !account) {
      showCustomAlert("يرجى ملء جميع الحقول", "error");
      return;
    }
    if (cost === undefined) {
      showCustomAlert("لا يمكن تحديد تكلفة الخدمة", "error");
      return;
    }

    if (service === "ألعاب") {
      if (!/^\d+$/.test(account)) {
        showCustomAlert("يرجى إدخال رقم صحيح للـ ID فقط.", "error");
        return;
      }
    }

    db.ref("users/" + currentUser.uid + "/balance").once("value").then(snapshot => {
      const balance = snapshot.val() || 0;
      if (balance < cost) {
        showCustomAlert("رصيدك لا يكفي لإتمام هذا الطلب", "error");
        return;
      }
      const order = {
        uid: currentUser.uid,
        type: service,
        service: sub,
        package: pack,
        account: account,
        status: "قيد التنفيذ",
        amount: cost,
        createdAt: new Date().toISOString()
      };
      const ordersRef = db.ref("orders");
      const newOrderRef = ordersRef.push();
      newOrderRef.set(order).then(() => {
        return db.ref("users/" + currentUser.uid).update({ balance: balance - cost });
      }).then(() => {
        showCustomAlert("تم إرسال الطلب وخصم الرصيد بنجاح", "success");
        mainService.value = "";
        subService.innerHTML = "";
        packageEl.innerHTML = "";
        accountInput.value = "";
        accountLabel.textContent = "اسم الحساب / ID:";
        accountInput.removeAttribute("pattern");
        accountInput.removeAttribute("title");
        accountInput.type = "text";
      }).catch(err => {
        console.error(err);
        showCustomAlert("حدث خطأ أثناء إرسال الطلب", "error");
      });
    });
  }

  function logout() {
    auth.signOut().then(() => {
      location.href = "index.html";
    });
  }

  function shareSite() {
    const url = "https://botcyber.github.io/Sheko-store-/";
    if (navigator.share) {
      navigator.share({
        title: "Sheko Store",
        text: "تفضلوا بزيارة موقع Sheko Store لشحن الألعاب والخدمات",
        url: url
      }).catch(console.error);
    } else {
      showCustomAlert("ميزة المشاركة غير مدعومة في متصفحك، يمكنك نسخ الرابط ومشاركته يدوياً.", "info");
    }
  }

  function copyLink() {
    const url = "https://botcyber.github.io/Sheko-store-/";
    navigator.clipboard.writeText(url).then(() => {
      showCustomAlert("تم نسخ رابط الموقع!", "success");
    }).catch(() => {
      showCustomAlert("فشل في نسخ الرابط، يرجى نسخه يدوياً.", "error");
    });
  }
</script>
</body>
</html>
