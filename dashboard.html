<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>لوحة التحكم | SHEKO STORE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial; background: #f2f2f2; margin: 0; padding: 0; }
    header { background: #111; color: #fff; padding: 15px; text-align: center; position: sticky; top: 0; }
    .content { padding: 20px; max-width: 600px; margin: auto; background: white; margin-top: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    select, input, button { width: 100%; padding: 10px; margin: 10px 0; border-radius: 8px; border: 1px solid #ccc; }
    button { background: #2196f3; color: white; border: none; cursor: pointer; }
    button:hover { background: #0b7dda; }
    .hidden { display: none; }
    footer { text-align: center; margin: 20px 0; font-size: 14px; }
    .top-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .top-info a { color: #fff; background: #e91e63; padding: 5px 10px; border-radius: 8px; text-decoration: none; }
  </style>
</head>
<body>
  <header>
    <div class="top-info">
      <span>رصيدك: <span id="userBalance">0 جنية</span></span>
      <div>
        <a href="account.html">معلومات حسابك</a>
        <a href="index.html">تسجيل الخروج</a>
      </div>
    </div>
    <h2>SHEKO STORE</h2>
  </header>

  <div class="content">
    <h3>طلب شحن</h3>
    <label>اختر الخدمة:</label>
    <select id="mainService">
      <option value="">-- اختر --</option>
      <option value="games">شحن الألعاب</option>
      <option value="social">مواقع التواصل الاجتماعي</option>
    </select>

    <div id="gamesSection" class="hidden">
      <label>اختر اللعبة:</label>
      <select id="gameOptions">
        <option value="">-- اختر اللعبة --</option>
        <option value="pubg">ببجي موبايل - 60 شدة (100ج) )</option>
        <option value="cod">كول أوف ديوتي - 220CP (250ج)</option>
        <option value="ff">فري فاير - 100 جوهرة (70ج)</option>
        <option value="fifa">فيفا - 20 كوينز (40ج)</option>
      </select>
      <label>الآي دي الخاص بك:</label>
      <input type="text" id="gameId" placeholder="ادخل ID اللعبة">
    </div>

    <div id="socialSection" class="hidden">
      <label>اكتب اسم حسابك في الخدمة:</label>
      <input type="text" id="socialAccount" placeholder="مثال: @username">
    </div>

    <button id="submitOrder">إرسال الطلب</button>

    <p style="color: red; text-align:center;" id="errorText"></p>
    <footer>
      إذا واجهت أي مشكلة راسلنا على واتساب: <b>01099874914</b>
    </footer>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getDatabase, ref, get, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAYcZ2_RjaI4fjP14QlqbUbL3rWvPPWnas",
      authDomain: "sheko-store.firebaseapp.com",
      databaseURL: "https://sheko-store-default-rtdb.firebaseio.com",
      projectId: "sheko-store",
      storageBucket: "sheko-store.appspot.com",
      messagingSenderId: "113892775847",
      appId: "1:113892775847:web:2aa4c11c3f5dd1d15f0882"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const mainService = document.getElementById("mainService");
    const gameOptions = document.getElementById("gameOptions");
    const gamesSection = document.getElementById("gamesSection");
    const socialSection = document.getElementById("socialSection");
    const submitOrder = document.getElementById("submitOrder");
    const gameId = document.getElementById("gameId");
    const socialAccount = document.getElementById("socialAccount");
    const userBalance = document.getElementById("userBalance");
    const errorText = document.getElementById("errorText");

    let currentUID = null;
    let balance = 0;

    const prices = {
      pubg: 50,
      cod: 250,
      ff: 70,
      fifa: 40
    };

    mainService.addEventListener("change", () => {
      gamesSection.classList.add("hidden");
      socialSection.classList.add("hidden");
      if (mainService.value === "games") {
        gamesSection.classList.remove("hidden");
      } else if (mainService.value === "social") {
        socialSection.classList.remove("hidden");
      }
    });

    onAuthStateChanged(auth, (user) => {
      if (user) {
        currentUID = user.uid;
        const userRef = ref(db, 'users/' + currentUID);
        onValue(userRef, (snapshot) => {
          const data = snapshot.val();
          balance = data?.balance || 0;
          userBalance.textContent = balance + " جنيه";
        });
      } else {
        window.location.href = "index.html";
      }
    });

    submitOrder.addEventListener("click", async () => {
      errorText.textContent = "";
      let type = mainService.value;
      let service = "";
      let cost = 0;
      let idOrAccount = "";

      if (type === "games") {
        service = gameOptions.value;
        if (!service || !gameId.value) {
          errorText.textContent = "يرجى ملء جميع الحقول.";
          return;
        }
        cost = prices[service];
        idOrAccount = gameId.value;
      } else if (type === "social") {
        if (!socialAccount.value) {
          errorText.textContent = "يرجى كتابة اسم الحساب.";
          return;
        }
        service = "خدمة تواصل";
        cost = 50; // سعر افتراضي
        idOrAccount = socialAccount.value;
      } else {
        errorText.textContent = "يرجى اختيار نوع الخدمة.";
        return;
      }

      if (cost > balance) {
        errorText.textContent = "رصيدك لا يكفي لإتمام الطلب.";
        return;
      }

      const orderRef = ref(db, `orders/${currentUID}_${Date.now()}`);
      await set(orderRef, {
        uid: currentUID,
        type,
        service,
        account: idOrAccount,
        cost,
        status: "قيد التنفيذ",
        createdAt: new Date().toISOString()
      });

      await set(ref(db, `users/${currentUID}/balance`), balance - cost);

      alert("تم إرسال طلبك بنجاح!");
      location.reload();
    });
  </script>
</body>
</html>
