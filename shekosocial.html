<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>

<!-- Cropper.js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

<style>
    body { font-family:sans-serif; background:#111; color:white; text-align:center; }
    input, select { width:90%; padding:10px; margin:7px 0; border-radius:10px; border:none; }
    button { background:#0f6; border:none; padding:10px 20px; margin-top:10px; border-radius:10px; cursor:pointer; }
    .link-item { background:#1a1a1a; padding:15px; border-radius:10px; margin:8px; text-align:right; }
    .actions button { margin-left:5px; }
    #cropContainer { width: 90%; margin:auto; display:none; }
    #cropImage { max-width:100%; border-radius:10px; }
</style>
</head>
<body>

<h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>

<h3>Ø±ÙØ¹ ØµÙˆØ±Ø© (Ù…Ø¹ Ù‚Øµ)</h3>
<input type="file" id="imgInput">

<div id="cropContainer">
    <h3>Ù‚Øµ Ø§Ù„ØµÙˆØ±Ø©</h3>
    <img id="cropImage">
    <br>
    <button onclick="saveCropped()">Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</button>
</div>

<hr>

<h3>Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯</h3>

<select id="iconSelect">
    <option value="ğŸŒ">Ù…ÙˆÙ‚Ø¹</option>
    <option value="ğŸ“¸">Instagram</option>
    <option value="ğŸµ">TikTok</option>
    <option value="ğŸ“˜">Facebook</option>
    <option value="â–¶ï¸">YouTube</option>
    <option value="ğŸ’¬">WhatsApp</option>
    <option value="ğŸ¦">Twitter</option>
</select>

<input id="nameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø·">
<input id="urlInput" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø·">
<button onclick="addLink()">Ø¥Ø¶Ø§ÙØ©</button>

<hr>

<h3>Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
<div id="linksList"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// Firebase
const firebaseConfig = {
    apiKey: "",
    authDomain: "",
    databaseURL: "",
    projectId: "",
    storageBucket: "",
    messagingSenderId: "",
    appId: ""
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let cropper;
let selectedFile;

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ù‚Øµ
document.getElementById("imgInput").addEventListener("change", function(e) {
    selectedFile = e.target.files[0];
    if (!selectedFile) return;

    let reader = new FileReader();
    reader.onload = function(ev) {
        document.getElementById("cropImage").src = ev.target.result;
        document.getElementById("cropContainer").style.display = "block";

        if (cropper) cropper.destroy();
        cropper = new Cropper(document.getElementById("cropImage"), {
            aspectRatio: 1,  // Ù…Ø±Ø¨Ø¹
            viewMode: 1
        });
    };
    reader.readAsDataURL(selectedFile);
});

// Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Øµ
function saveCropped() {
    if (!cropper) return;

    let canvas = cropper.getCroppedCanvas({
        width: 400,
        height: 400
    });

    let base64 = canvas.toDataURL("image/png");

    db.ref("profile/image").set(base64);
    alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ù‚ØµÙ‡Ø§ âœ”");

    document.getElementById("cropContainer").style.display = "none";
}

// Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯
function addLink() {
    let icon = document.getElementById("iconSelect").value;
    let name = document.getElementById("nameInput").value;
    let url  = document.getElementById("urlInput").value;

    if (!name || !url) return alert("Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø§Ø¨Ø·");

    let id = db.ref("profile/links").push().key;
    db.ref("profile/links/" + id).set({ icon, name, url });

    document.getElementById("nameInput").value = "";
    document.getElementById("urlInput").value = "";
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù…Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù
db.ref("profile/links").on("value", snap => {
    let html = "";
    snap.forEach(child => {
        let id = child.key;
        let data = child.val();

        html += `
        <div class="link-item">
            <b>${data.icon} ${data.name}</b> â€” ${data.url}<br>
            <div class="actions">
                <button onclick="editLink('${id}', '${data.name}', '${data.url}')">ØªØ¹Ø¯ÙŠÙ„</button>
                <button onclick="deleteLink('${id}')" style="background:#f33">Ø­Ø°Ù</button>
            </div>
        </div>
        `;
    });
    document.getElementById("linksList").innerHTML = html;
});

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø·
function editLink(id, oldName, oldUrl) {
    let newName = prompt("Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯:", oldName);
    if (!newName) return;

    let newUrl  = prompt("Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯:", oldUrl);
    if (!newUrl) return;

    db.ref("profile/links/" + id).update({
        name: newName,
        url: newUrl
    });
}

// Ø­Ø°Ù Ø§Ù„Ø±Ø§Ø¨Ø·
function deleteLink(id) {
    if (confirm("Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")) {
        db.ref("profile/links/" + id).remove();
    }
}
</script>

</body>
</html>
