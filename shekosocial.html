<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<!-- CropperJS -->
<link  href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

<style>
body {font-family: Arial; background:#111; color:white; padding:20px; text-align:center;}
input, button, select {padding:10px; margin:10px; border-radius:6px; border:none;}
button {background:red; color:white; cursor:pointer;}
.box {background:#222; padding:15px; border-radius:8px; margin-top:20px;}

#cropArea {display:none; margin-top:20px;}
#cropArea img {max-width:100%; border-radius:10px;}

.crop-controls button {
    background:#333;
    margin:5px;
    padding:10px 12px;
}
</style>

</head>
<body>

<h2>ğŸ”¥ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… â€“ Ù‚Øµ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ±ÙØ¹Ù‡Ø§ ğŸ”¥</h2>

<div class="box">
  <h3>Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
  <input type="file" id="mainImage">
</div>

<!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Øµ -->
<div id="cropArea">
    <h3>âœ‚ Ù‚Øµ Ø§Ù„ØµÙˆØ±Ø©</h3>
    <img id="imageToCrop">

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="crop-controls">
        <button onclick="cropper.zoom(0.1)">â• ØªÙƒØ¨ÙŠØ±</button>
        <button onclick="cropper.zoom(-0.1)">â– ØªØµØºÙŠØ±</button>
        <button onclick="cropper.rotate(90)">â†ª ØªØ¯ÙˆÙŠØ± ÙŠÙ…ÙŠÙ†</button>
        <button onclick="cropper.rotate(-90)">â†© ØªØ¯ÙˆÙŠØ± ÙŠØ³Ø§Ø±</button>
        <button onclick="resetCrop()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø©</button>
        <button onclick="uploadCroppedImage()">âœ” Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</button>
    </div>
</div>

<script>
/* ------------------------ Firebase ------------------------ */
const firebaseConfig = {
  apiKey: "AIzaSyAYcZ2_RjaI4fjP14QlqbUbL3rWvPPWnas",
  authDomain: "sheko-store.firebaseapp.com",
  databaseURL: "https://sheko-store-default-rtdb.firebaseio.com",
  projectId: "sheko-store",
  storageBucket: "sheko-store.appspot.com",
  messagingSenderId: "113892775847",
  appId: "1:113892775847:web:2aa4c11c3f5dd1d15f0882"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();


let cropper;

/* ------------------------ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© ------------------------ */
document.getElementById("mainImage").addEventListener("change", function () {
    const file = this.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
        const img = document.getElementById("imageToCrop");
        img.onload = function () {

            document.getElementById("cropArea").style.display = "block";

            if (cropper) cropper.destroy();

            cropper = new Cropper(img, {
                aspectRatio: 1,
                viewMode: 1,
                autoCropArea: 1,
                background:false
            });
        };

        img.src = e.target.result;
    };

    reader.readAsDataURL(file);
});


/* ------------------------ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù‚Øµ ------------------------ */
function resetCrop(){
    if (cropper) {
        cropper.reset();
    }
}


/* ------------------------ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Øµ ------------------------ */
function uploadCroppedImage() {
    if (!cropper) {
        alert("âŒ Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹!");
        return;
    }

    const canvas = cropper.getCroppedCanvas({
        width: 800,
        height: 800,
        fillColor: "#000"
    });

    const base64 = canvas.toDataURL("image/jpeg", 0.9);

    db.ref("mainPage/image")
      .set(base64)
      .then(() => alert("âœ” ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!"))
      .catch(err => alert("âŒ Ø®Ø·Ø£: " + err.message));
}

</script>

</body>
</html>
