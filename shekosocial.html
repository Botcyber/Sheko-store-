<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>

<!-- Cropper.js -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

<style>
body {
    font-family: sans-serif;
    background: #111;
    color: white;
    text-align: center;
    padding: 20px;
}
input, select, button {
    width: 90%;
    padding: 10px;
    margin: 5px 0;
    border-radius: 10px;
    border: none;
}
button { cursor: pointer; background: #0f6; color: #000; }
button.delete { background: #f33; color: #fff; }
.link-item {
    background: #1a1a1a;
    padding: 15px;
    margin: 8px;
    border-radius: 10px;
    text-align: right;
}
.actions button { margin-left: 5px; }
#cropContainer { display: none; margin-top: 10px; }
#cropImage { max-width: 100%; border-radius: 10px; }
</style>
</head>
<body>

<h2>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>

<!-- Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© -->
<h3>Ø±ÙØ¹ ØµÙˆØ±Ø© (Ù…Ø¹ Ù‚Øµ)</h3>
<input type="file" id="imgInput">
<div id="cropContainer">
    <h4>Ù‚Øµ Ø§Ù„ØµÙˆØ±Ø©</h4>
    <img id="cropImage">
    <br>
    <button onclick="saveCropped()">Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©</button>
</div>

<hr>

<!-- Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· -->
<h3>Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯</h3>
<select id="iconSelect">
    <option value="ğŸŒ">Ù…ÙˆÙ‚Ø¹</option>
    <option value="ğŸ“¸">Instagram</option>
    <option value="ğŸµ">TikTok</option>
    <option value="ğŸ“˜">Facebook</option>
    <option value="â–¶ï¸">YouTube</option>
    <option value="ğŸ’¬">WhatsApp</option>
    <option value="ğŸ¦">Twitter</option>
</select>
<input id="nameInput" placeholder="Ø§Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø·">
<input id="urlInput" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø·">
<button onclick="addLink()">Ø¥Ø¶Ø§ÙØ©</button>

<hr>

<h3>Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
<div id="linksList"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
    apiKey: "",
    authDomain: "",
    databaseURL: "",
    projectId: "",
    storageBucket: "",
    messagingSenderId: "",
    appId: ""
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
let cropper;
let selectedFile;

// Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø©
document.getElementById("imgInput").addEventListener("change", function(e) {
    selectedFile = e.target.files[0];
    if (!selectedFile) return;

    let reader = new FileReader();
    reader.onload = function(ev) {
        document.getElementById("cropImage").src = ev.target.result;
        document.getElementById("cropContainer").style.display = "block";

        if (cropper) cropper.destroy();
        cropper = new Cropper(document.getElementById("cropImage"), {
            aspectRatio: 1, // Ù…Ø±Ø¨Ø¹
            viewMode: 1
        });
    };
    reader.readAsDataURL(selectedFile);
});

// Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù‚Øµ
function saveCropped() {
    if (!cropper) return alert("Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¹Ø¯!");
    let canvas = cropper.getCroppedCanvas({ width: 400, height: 400 });
    let base64 = canvas.toDataURL("image/png");
    db.ref("profile/image").set(base64).then(() => alert("ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!"));
    document.getElementById("cropContainer").style.display = "none";
}

// Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯
function addLink() {
    let icon = document.getElementById("iconSelect").value;
    let name = document.getElementById("nameInput").value.trim();
    let url  = document.getElementById("urlInput").value.trim();
    if (!name || !url) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");

    let id = db.ref("profile/links").push().key;
    db.ref("profile/links/" + id).set({ icon, name, url });

    document.getElementById("nameInput").value = "";
    document.getElementById("urlInput").value = "";
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù
db.ref("profile/links").on("value", snap => {
    let html = "";
    snap.forEach(child => {
        let id = child.key;
        let data = child.val();
        html += `
        <div class="link-item">
            <b>${data.icon} ${data.name}</b> â€” ${data.url}<br>
            <div class="actions">
                <button onclick="editLink('${id}', '${data.name}', '${data.url}')">ØªØ¹Ø¯ÙŠÙ„</button>
                <button class="delete" onclick="deleteLink('${id}')">Ø­Ø°Ù</button>
            </div>
        </div>
        `;
    });
    document.getElementById("linksList").innerHTML = html;
});

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø·
function editLink(id, oldName, oldUrl) {
    let newName = prompt("Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯:", oldName);
    if (!newName) return;
    let newUrl = prompt("Ø±Ø§Ø¨Ø· Ø¬Ø¯ÙŠØ¯:", oldUrl);
    if (!newUrl) return;

    db.ref("profile/links/" + id).update({ name: newName, url: newUrl });
}

// Ø­Ø°Ù Ø§Ù„Ø±Ø§Ø¨Ø·
function deleteLink(id) {
    if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø­Ø°ÙØŸ")) {
        db.ref("profile/links/" + id).remove();
    }
}
</script>
</body>
</html>
