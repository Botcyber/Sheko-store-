<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¥Ø¯Ø§Ø±Ø© ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„ØªØµÙˆÙŠØª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Cairo', sans-serif; background: #f7f7f7; margin: 0; padding: 20px; direction: rtl; }
    h1 { text-align: center; color: #333; }
    .box { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); max-width: 600px; margin: auto; margin-bottom: 20px; }
    label { font-weight: bold; display: block; margin: 10px 0 5px; }
    input, select, button { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #ccc; margin-bottom: 10px; }
    button { background: #007bff; color: white; font-weight: bold; cursor: pointer; border: none; }
    button:hover { background: #0056b3; }
    .status { text-align: center; margin-top: 10px; font-weight: bold; }
    .list { background: #fff; padding: 15px; border-radius: 10px; margin-top: 20px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .user-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .user-item span { font-weight: bold; }
    .user-item button { width: auto; padding: 5px 10px; background: red; }
  </style>
</head>
<body>

  <h1>ğŸ¯ Ø¥Ø¯Ø§Ø±Ø© ÙØ¹Ø§Ù„ÙŠØ© Ø§Ù„ØªØµÙˆÙŠØª</h1>

  <div class="box">
    <label>ğŸ“Œ UID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
    <input type="text" id="uidInput" placeholder="Ø£Ø¯Ø®Ù„ UID Ù„Ø¥Ø¶Ø§ÙØªÙ‡ Ø¥Ù„Ù‰ Ø§Ù„ØªØµÙˆÙŠØª">

    <button onclick="addUser()">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ø§Ù„ØªØµÙˆÙŠØª</button>

    <label>ğŸ”’ Ø­Ø§Ù„Ø© Ø§Ù„ØªØµÙˆÙŠØª</label>
    <select id="voteStatus">
      <option value="open">Ù…ÙØªÙˆØ­</option>
      <option value="closed">Ù…ØºÙ„Ù‚</option>
    </select>
    <button onclick="updateVoteStatus()">ğŸ” ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØµÙˆÙŠØª</button>

    <label>â³ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØµÙˆÙŠØª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ (Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚)</label>
    <input type="number" id="closeAfter" placeholder="Ù…Ø«Ø§Ù„: 10">
    <button onclick="startCountdown()">ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ</button>

    <div class="status" id="countdownText"></div>
  </div>

  <div class="list" id="userList">
    <h3>ğŸ§‘â€ğŸ’» Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ÙÙŠ Ø§Ù„ØªØµÙˆÙŠØª:</h3>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAYcZ2_RjaI4fjP14QlqbUbL3rWvPPWnas",
      authDomain: "sheko-store.firebaseapp.com",
      databaseURL: "https://sheko-store-default-rtdb.firebaseio.com",
      projectId: "sheko-store",
      storageBucket: "sheko-store.appspot.com",
      messagingSenderId: "113892775847",
      appId: "1:113892775847:web:2aa4c11c3f5dd1d15f0882"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const uidInput = document.getElementById("uidInput");
    const voteStatus = document.getElementById("voteStatus");
    const closeAfter = document.getElementById("closeAfter");
    const countdownText = document.getElementById("countdownText");
    const userList = document.getElementById("userList");

    function addUser() {
      const uid = uidInput.value.trim();
      if (!uid) return alert("Ø£Ø¯Ø®Ù„ UID");

      db.ref("users/" + uid).once("value").then(snap => {
        if (!snap.exists()) return alert("Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");

        const data = snap.val();
        const username = data.username || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
        const photo = data.photoURL || "";

        db.ref("voting/users/" + uid).set({
          uid,
          username,
          photo,
          votes: 0
        }).then(() => {
          alert("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­");
          uidInput.value = "";
          loadUsers();
        });
      });
    }

    function updateVoteStatus() {
      const status = voteStatus.value;
      db.ref("voting/status").set(status).then(() => {
        alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ø¥Ù„Ù‰: " + (status === "open" ? "Ù…ÙØªÙˆØ­" : "Ù…ØºÙ„Ù‚"));
      });
    }

    function deleteUser(uid) {
      if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ")) return;
      db.ref("voting/users/" + uid).remove().then(loadUsers);
    }

    function startCountdown() {
      const mins = parseInt(closeAfter.value);
      if (isNaN(mins) || mins <= 0) return alert("Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø¯Ù‚Ø§Ø¦Ù‚ ØµØ­ÙŠØ­");

      const endTime = Date.now() + mins * 60000;
      db.ref("voting/endTime").set(endTime);

      alert("ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù…Ø¯Ø© " + mins + " Ø¯Ù‚ÙŠÙ‚Ø©");
      countdownText.textContent = "â³ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ø¨Ø¯Ø£...";
    }

    function loadUsers() {
      db.ref("voting/users").once("value").then(snap => {
        userList.innerHTML = "<h3>ğŸ§‘â€ğŸ’» Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† ÙÙŠ Ø§Ù„ØªØµÙˆÙŠØª:</h3>";
        if (!snap.exists()) {
          userList.innerHTML += "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒÙŠÙ†.</p>";
          return;
        }

        snap.forEach(child => {
          const user = child.val();
          const div = document.createElement("div");
          div.className = "user-item";
          div.innerHTML = `
            <span>${user.username}</span>
            <button onclick="deleteUser('${user.uid}')">âŒ Ø­Ø°Ù</button>
          `;
          userList.appendChild(div);
        });
      });
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    db.ref("voting/status").on("value", snap => {
      const status = snap.val() || "closed";
      voteStatus.value = status;
    });

    // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    setInterval(() => {
      db.ref("voting/endTime").once("value").then(snap => {
        const end = snap.val();
        if (end && Date.now() >= end) {
          db.ref("voting/status").set("closed");
          db.ref("voting/endTime").remove();
          countdownText.textContent = "ğŸš« ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØµÙˆÙŠØª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§";
        } else if (end) {
          const remaining = Math.ceil((end - Date.now()) / 1000);
          countdownText.textContent = "â³ Ù…ØªØ¨Ù‚ÙŠ: " + Math.floor(remaining / 60) + " Ø¯Ù‚ÙŠÙ‚Ø© Ùˆ" + (remaining % 60) + " Ø«Ø§Ù†ÙŠØ©";
        } else {
          countdownText.textContent = "";
        }
      });
    }, 1000);

    loadUsers();
  </script>

</body>
</html>
